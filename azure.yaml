---
name: "hemoclub-containerapp"
type: "Microsoft.App/containerApps"
location: "East US"
properties:
  workloadProfileName: "Consumption"
  configuration:
    secrets:
      - name: "connection-string"
      - name: "rails-key"
      - name: "app-host"
      - name: "webhook-key"
      - name: "smtp-username"
      - name: "smtp-password"
      - name: "smtp-address"
      - name: "smtp-port"
      - name: "smtp-sender"
      - name: "api-mailer-url"
      - name: "api-mailer-secret"
      - name: "api-mailer-senders"
    activeRevisionsMode: "Single"
    ingress:
      external: "true"
      targetPort: "3000"
  template:
    containers:
      - image: "docker.io/joaquincasal/hemoclub:#{IMAGE_VERSION}#"
        name: "hemoclub-containerapp"
        env:
          - name: "RACK_ENV"
            value: "production"
          - name: "RAILS_ENV"
            value: "production"
          - name: "DATABASE_URL"
            secretRef: "connection-string"
          - name: "SECRET_KEY_BASE"
            secretRef: "rails-key"
          - name: "RAILS_SERVE_STATIC_FILES"
            value: "true"
          - name: "RAILS_LOG_TO_STDOUT"
            value: "true"
          - name: "APP_HOST"
            secretRef: "app-host"
          - name: "WEBHOOK_KEY"
            secretRef: "webhook-key"
          - name: "APP_VERSION"
            value: "#{IMAGE_VERSION}#"
          - name: "FECHA_INICIO_CONTACTO"
            value: "2024-06-30"
          - name: "SMTP_USERNAME"
            secretRef: "smtp-username"
          - name: "SMTP_PASSWORD"
            secretRef: "smtp-password"
          - name: "SMTP_ADDRESS"
            secretRef: "smtp-address"
          - name: "SMTP_PORT"
            secretRef: "smtp-port"
          - name: "SMTP_SENDER"
            secretRef: "smtp-sender"
          - name: "API_MAILER_URL"
            secretRef: "api-mailer-url"
          - name: "API_MAILER_ENDPOINT"
            value: "/emails:send?api-version=2023-03-31"
          - name: "API_MAILER_SECRET"
            secretRef: "api-mailer-secret"
          - name: "API_MAILER_SENDERS"
            secretRef: "api-mailer-senders"
        resources:
          cpu: "2"
          memory: "4Gi"
    scale:
      minReplicas: "1"
      maxReplicas: "1"
